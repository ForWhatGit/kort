<!DOCTYPE html>
<html lang="en">
	<head>
		<%- include('../partials/header.ejs') %>
		
		<!-- Include plotly.js -->
		<script type="text/javascript" src="/plotlyjs/plotly.min.js"></script>

		<title>Cardsort Results</title>
		
	</head>
	<body>
		<%- include('../partials/admin_header.ejs') %>
		
		<div id='heatmap'></div>
		
		<script>
		
		//https://plot.ly/javascript/heatmaps/
		var xValues = <%- JSON.stringify(study.cards) %>;
		var yValues = <%- JSON.stringify(study.groups) %>;

		var zValues = <%- JSON.stringify(matrix) %>;

		var colorscaleValue = [
		  [0, '#3D9970'],
		  [1, '#001f3f']
		];
		
		var text = xValues.map((xi, i) => yValues.map((yi, j) =>
		`Card: ${xi}<br>Group: ${yi}<br>Number: ${zValues[i][j]}`));

		var data = [{
		  x: xValues,
		  y: yValues,
		  z: zValues,
		  type: 'heatmap',
		  colorscale: colorscaleValue,
		  showscale: false,
		  text: text,
		  hoverinfo: 'text',
		}];
		
		var layout = {
		  title: 'Cardsort Heatmap',
		  annotations: [],
		  xaxis: {
			ticks: '',
			side: 'top',
			fixedrange: true
		  },
		  yaxis: {
			ticks: '',
			fixedrange: true
		  }
		};

		for ( var i = 0; i < yValues.length; i++ ) {
		  for ( var j = 0; j < xValues.length; j++ ) {
			var currentValue = zValues[i][j];
			if (currentValue != 0.0) {
			  var textColor = 'white';
			}else{
			  var textColor = 'black';
			}
			var result = {
			  xref: 'x1',
			  yref: 'y1',
			  x: xValues[j],
			  y: yValues[i],
			  text: zValues[i][j],
			  font: {
				family: 'Arial',
				size: 12,
				color: 'rgb(50, 171, 96)'
			  },
			  showarrow: false,
			  font: {
				color: textColor
			  }
			};
			layout.annotations.push(result);
		  }
		}

		Plotly.newPlot('heatmap', data, layout, {displayModeBar: false});

		
		</script>
		
		
	</body>
</html>
