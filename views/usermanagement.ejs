<!DOCTYPE html>
<html lang="en">
	<head>
		<%- include('partials/header.ejs') %>
		<title>Kort: User Management</title>
		<style>
		.errorMessage, .successMessage {
			display:none;
		}
		</style>
		<script type="text/javascript">
			$( document ).ready(function() {
			    $( ".successMessage" ).slideDown(300).delay(2000).slideUp(300);
			    $( ".errorMessage" ).slideDown(300);
			});
			function confirmDelete(href,username){
				 bootbox.confirm({
			    	size: 'small',
			    	closeButton: false,
				    message: "Delete "+username+"? This will also delete any studies created by this user.",
				    buttons: {confirm: {label: 'Delete',className: 'btn-danger'},
			        		  cancel: {label: 'Cancel',className: 'btn-link'}
				    },
				    callback: function (result) {
				    	if(result){
				    		window.location.href = href
				    	}
				    }
				});
			}
		</script>
	</head>
	<body>
	<%- include('partials/admin_header.ejs') %>
	<div class="container">
		<% if (createUserErrorMessage.length > 0) { %>
			<div class="alert alert-danger errorMessage">
			  <%= createUserErrorMessage %>
			</div>
		<% } %>
		<% if (createUserSuccessMessage.length > 0) { %>
			<div class="alert alert-success successMessage">
			  <strong>Success!</strong> <%= createUserSuccessMessage %>
			</div>
		<% } %>
		<h3>Users</h3>
		<table class='table table-condensed'>
			<thead>
				<tr>
				<th>Email</th>
				<th></th>
				<th></th>
				</tr>
			</thead>
			<tbody>
				<% for(var i=0; i<users.length; i++) {%>
				<tr>
					<td><%= users[i].email %></td>
					<td></td>
					<td><a href='#' onclick="confirmDelete('/deleteuser/<%= users[i]._id %>/','<%= users[i].email %>')"><i class="fa fa-trash-o fa-lg text-danger" aria-hidden="true" title="Delete User"></i></a></td>
					
				</tr>
				<% } %>
			
				<tr>
					<form class="form-inline" action="/createuser" method="post">
					<td>
						<div class="form-group">
							<div class="inputGroupContainer">
								<div class="input-group" style='width:100%'>
									<input name="email" autocomplete="off" placeholder="Email Address" class="form-control" type="text" />
								</div>
						  </div>
						</div>
					</td>
					<td>
						<div class="form-group">
							<div class="inputGroupContainer">
								<div class="input-group" style='width:100%'>
									<input  name="password" autocomplete="off" placeholder="Password" class="form-control" type="password" />
								</div>
						  </div>
						</div>
					</td>
					<td>
						<div class="form-group">
							<div class="inputGroupContainer">
								<div class="input-group">
									<button type="submit" class="btn btn-default" value="Create User">Create User</button>
								</div>
						  	</div>
						</div>
					</td>
					</form>
				</tr>

			</tbody>
		</table>
	</div>
	</body>
</html>
